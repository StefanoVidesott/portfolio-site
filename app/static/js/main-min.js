document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".nav-toggle"),t=document.querySelector(".nav-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("nav-menu_visible"),t.classList.contains("nav-menu_visible")?e.setAttribute("aria-label","Chiudi menu"):e.setAttribute("aria-label","Apri menu")});let a=document.querySelectorAll(".reveal"),s={threshold:.15,rootMargin:"0px 0px -50px 0px"},n=new IntersectionObserver(function(e,t){e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("active"),t.unobserve(e.target))})},s);a.forEach(e=>{n.observe(e)});let i=document.querySelector(".typed-text"),r=document.querySelector(".cursor");if(i&&r){let l=i.getAttribute("data-words").split("|"),o=0,c=0;function d(){c<l[o].length?(r.classList.contains("typing")||r.classList.add("typing"),i.textContent+=l[o].charAt(c),c++,setTimeout(d,100)):(r.classList.remove("typing"),setTimeout(m,2e3))}function m(){c>0?(r.classList.contains("typing")||r.classList.add("typing"),i.textContent=l[o].substring(0,c-1),c--,setTimeout(m,50)):(r.classList.remove("typing"),++o>=l.length&&(o=0),setTimeout(d,600))}setTimeout(d,2e3)}let u=document.getElementById("themeToggle"),g=u?u.querySelector("i"):null,y=document.documentElement;if(u&&g){let v=localStorage.getItem("theme");v?(y.setAttribute("data-theme",v),"light"===v&&g.classList.replace("fa-sun","fa-moon")):y.setAttribute("data-theme","dark"),u.addEventListener("click",()=>{"dark"===y.getAttribute("data-theme")?(y.setAttribute("data-theme","light"),localStorage.setItem("theme","light"),g.classList.replace("fa-sun","fa-moon")):(y.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark"),g.classList.replace("fa-moon","fa-sun"))})}let f=document.getElementById("contactForm"),p=document.getElementById("formResponse"),h=document.getElementById("submitBtn"),b=document.getElementById("btnText");f&&f.addEventListener("submit",async e=>{e.preventDefault();let t=b.innerText;h.disabled=!0,b.innerText="Invio in corso...",p.className="form-message";let a=document.querySelector('[name="cf-turnstile-response"]'),s=a?a.value:"";if(!s){p.innerText="Per favore, attendi la verifica di sicurezza.",p.classList.add("error"),h.disabled=!1,b.innerText=t;return}let n={name:document.getElementById("name").value,email:document.getElementById("email").value,message:document.getElementById("message").value,turnstile_token:s};try{let i=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(i.ok)p.innerText="Messaggio inviato con successo!",p.className="form-message success",f.reset(),"undefined"!=typeof turnstile&&turnstile.reset();else throw Error("Errore dal server")}catch(r){p.innerText="Si \xe8 verificato un errore. Riprova pi\xf9 tardi.",p.classList.add("error")}finally{h.disabled=!1,b.innerText=t}})});